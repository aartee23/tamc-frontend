@*
* Copyright 2015 HM Revenue & Customs
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*     http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*@

@(data: models.UpdateRelationshipConfirmationModel,
    relevantDate: Option[org.joda.time.LocalDate] = None,isEnded : Option[Boolean] = None,relationEndDate: Option[org.joda.time.LocalDate]=None
   )(implicit lang: Lang, 
      request: Request[_],
      breadcrumb: uk.gov.hmrc.play.breadcrumb.model.Breadcrumb,
      user: details.TamcUser)

@import play.twirl.api.Html
@import views.helpers.TextGenerators
@import config.ApplicationConfig
@import services.TimeService
@import uk.gov.hmrc.time.TaxYearResolver
@templates.tamc_main(
    title = Messages("title.pattern", Messages("title.confirm-transferor")),
        mainConfig = views.helpers.MainConfig(
        maybeMainDataAttributes = Some(Html("data-journey=marriage-allowance:stage:confirm")))) {
        @if(ApplicationConfig.isWelshEnabled){
		    @templates.lang_button(controllers.routes.LanguageController.switchToEnglishConfirmUpdate.toString(), 
		               controllers.routes.LanguageController.switchToWelshConfirmUpdate.toString())
		}
@if(data.endRelationshipReason.endReason == "REJECT" && isEnded.get == true && relevantDate.get.getYear!= TimeService.getCurrentTaxYear){
<h1 id="confirm-page" class="heading-xlarge">@Html(Messages("confirm.recipient.ended.reject.heading"))</h1>
<table>
    <tr>
        @data.fullName.map[Option[String]](_.fullName).flatten.map {name =>
        <td>@Html(Messages("change.status.confirm.field.your-name"))</td>
        <td id="transferor-name">@name</td>
        <td>&nbsp;</td>
    </tr>
    <tr>
        }.getOrElse("")
        <td>@Html(Messages("generic.email"))</th>
        <td id="email">@data.email</td>
        <td><a href="confirm-email" id="edit-email">@Html(Messages("generic.change"))</a></td>
    </tr>
    </table>

    <div class="notice"><img class="icon icon-information" src="@routes.Assets.at("images/icon-information.png")">
    <strong id=confirm-note class="bold-small">@Html(Messages("pages.ended.reject.message",TaxYearResolver.startOfTaxYear(relevantDate.get.getYear).getYear,TaxYearResolver.startOfTaxYear(relationEndDate.get.getYear).getYear))</strong>
</div>
<ul class="list-bullet space-smaller">
    <li>@Html(Messages("pages.ended.reject.message1",TextGenerators.ukDateTransformer(relevantDate)))</li>
    <li>@Html(Messages("pages.ended.reject.message2"))</li>
</ul>
}else{
        
<h1 id="confirm-page" class="heading-xlarge">@Html(Messages("confirm.transferor.heading"))</h1>
<table>
    <tr>
       @data.fullName.map[Option[String]](_.fullName).flatten.map {name =>
        <td>@Html(Messages("change.status.confirm.field.your-name"))</td>
        <td id="transferor-name">@name</td>
        <td>&nbsp;</td>
      </tr>
    <tr>
     }.getOrElse("")
      <td>@Html(Messages("generic.email"))</th>
      <td id="email">@data.email</td>
      <td><a href="confirm-email" id="edit-email">@Html(Messages("generic.change"))</a></td>
    </tr>
    <tr>
      <td>@Html(Messages("change.status.realtionship-end"))</td>
      <td id="end-reason">@Html(Messages(s"change.status.reason-${data.endRelationshipReason.endReason}"))</td>
      <td>&nbsp;</td>
    </tr>
    @if(data.endRelationshipReason.endReason == "DIVORCE_CY" || data.endRelationshipReason.endReason == "DIVORCE_PY") {
    <tr>
        <td>@Html(Messages("change.status.divorce.h1"))</td>
        <td id="divorce-date">@TextGenerators.ukDateTransformer(data.endRelationshipReason.dateOfDivorce)</td>
        <td><a href="divorce-select-year" id="edit-divorce">@Html(Messages("generic.change"))</a></td>
    </tr>
    }
</table>
@if(data.endRelationshipReason.endReason == "CANCEL") {
    <div class="notice"><img class="icon icon-information" src="@routes.Assets.at("images/icon-information.png")">
        <strong class="bold-small">@Html(Messages("pages.confirm.message"))</strong>
    </div>
    <ul class="list-bullet space-smaller">
        <li>@Html(Messages("pages.confirm.message1",TextGenerators.ukDateTransformer(relevantDate)))</li>
        <li>@Html(Messages("pages.confirm.message2",TextGenerators.ukDateTransformer(Some(TimeService.getEffectiveDate(data.endRelationshipReason)))))</li></ul>
}

@if(data.endRelationshipReason.endReason == "REJECT"){
<div class="notice"><img class="icon icon-information" src="@routes.Assets.at("images/icon-information.png")">
    <strong class="bold-small">@Html(Messages("pages.confirm.message"))</strong>
</div>
<ul class="list-bullet space-smaller">
    <li>@Html(Messages("pages.reject.message1",TextGenerators.ukDateTransformer(relevantDate)))</li>
    <li>@Html(Messages("pages.reject.message2"))</li>
    <li>@Html(Messages("pages.reject.message3"))</li>
</ul>
}

@if(data.endRelationshipReason.endReason == "DIVORCE_CY") {
 @if(data.role.get == "Transferor"){
    @if(data.endRelationshipReason.dateOfDivorce.get.getYear != TimeService.getCurrentTaxYear){
        <div class="notice"><img class="icon icon-information" src="@routes.Assets.at("images/icon-information.png")">
            <strong class="bold-small">@Html(Messages("pages.confirm.divorce.cy.prev.message"))</strong>
        </div>
        <ul class="list-bullet space-smaller">
            <li>@Html(Messages("pages.confirm.divorce.cy.prev.message1",TextGenerators.ukDateTransformer(Some(TimeService.getEffectiveUntilDate(data.endRelationshipReason).get))))</li>
            <li>@Html(Messages("pages.confirm.divorce.cy.prev.message2"))</li>
        </ul>
    } else {
        <div class="notice"><img class="icon icon-information" src="@routes.Assets.at("images/icon-information.png")">
            <strong class="bold-small">@Html(Messages("pages.confirm.divorce.cy.message",TextGenerators.ukDateTransformer(relevantDate)))</strong>
        </div>
        <ul class="list-bullet space-smaller">
            <li>@Html(Messages("pages.confirm.divorce.cy.message1",TextGenerators.ukDateTransformer(Some(TimeService.getEffectiveDate(data.endRelationshipReason)))))</li>
        </ul>
      }
   }
@if(data.role.get == "Recipient") {
    @if(data.endRelationshipReason.dateOfDivorce.get.getYear != TimeService.getCurrentTaxYear){
    <div class="notice"><img class="icon icon-information" src="@routes.Assets.at("images/icon-information.png")">
        <strong class="bold-small">@Html(Messages("pages.confirm.divorce.cy.prev.message"))</strong>
    </div>
    <ul class="list-bullet space-smaller">
        <li>@Html(Messages("pages.confirm.recipient.divorce.cy.prev.message1",TextGenerators.ukDateTransformer(Some(TimeService.getEffectiveUntilDate(data.endRelationshipReason).get))))</li>
        <li>@Html(Messages("pages.confirm.recipient.divorce.cy.prev.message2"))</li>
    </ul>
    } else {
    <div class="notice"><img class="icon icon-information" src="@routes.Assets.at("images/icon-information.png")">
        <strong class="bold-small">@Html(Messages("pages.confirm.divorce.cy.prev.message",TextGenerators.ukDateTransformer(relevantDate)))</strong>
    </div>
    <ul class="list-bullet space-smaller">
        <li>@Html(Messages("pages.confirm.recipient.divorce.cy.message1",TextGenerators.ukDateTransformer(Some(TimeService.getEffectiveUntilDate(data.endRelationshipReason).get))))</li>
        <li>@Html(Messages("pages.confirm.recipient.divorce.cy.message2",TextGenerators.ukDateTransformer(Some(TimeService.getEffectiveDate(data.endRelationshipReason)))))</li>
    </ul>
    }
  }
}

@if(data.endRelationshipReason.endReason == "DIVORCE_PY"){
    <div class="notice"><img class="icon icon-information" src="@routes.Assets.at("images/icon-information.png")">
        <strong class="bold-small">@Html(Messages("pages.confirm.divorce.py.message",TextGenerators.ukDateTransformer(relevantDate)))</strong>
    </div>
    <ul class="list-bullet space-smaller">
        <li>@Html(Messages("pages.confirm.divorce.py.message1"))</li>
        <li>@Html(Messages("pages.confirm.divorce.py.message2",TextGenerators.ukDateTransformer(relevantDate)))</li>
    </ul>
}

<br>
}
<div class="form-group">
<p>
  <a href="@{controllers.routes.UpdateRelationshipController.confirmUpdateAction}" id="confirmRemoval" class="button" role="button">@Html(Messages("confirm.cancellation.button"))</a>
</p>
</div>
<a href="@controllers.routes.UpdateRelationshipController.history" class="link-back">@Html(Messages("generic.back"))</a>
}

